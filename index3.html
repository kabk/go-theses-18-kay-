<!DOCTYPE html>
<html lang="en">

<head>
   <title>CMD</title>
   <script src='jquery-3.2.1.min.js'></script>
   <link rel="stylesheet" href="css/style.css">
   <link href="https://fonts.googleapis.com/css?family=PT+Mono" rel="stylesheet">
  
</head>

<body>
   <article>
   <div class="speechButton"  id='S1'>&#x2706;</div>
      <h1 id="H1">CROSS MODAL DESIGN</h1>
      <p id="abstract">We live in a visual-oriented world.  Especially for those, including myself, who pursue the job of a designer. For us whoâ€™s practice consists of almost only visual purposes, it is crucial we question the importance of that particular perception we use the most. This profession brings a lot of visual conditions on top of our already existing pictorial obsession. Seeing is part of a collective unconsciousness we all share. I want to find out what caused this shift and if there are any alternatives to the current sensory hierarchy. Is this notion of visual domination true or is it merely an assumption? What happens when one of our sense organs stops functioning and what are the right substitutions for it. My main goal of writing this text is to find out how our vision can possibly make room for other senses. Perhaps limiting our focus on vision will make us see better.</p>
   </article>
   


</div>

  <p id="textarea" style="width:200px;height:200px;">We see to believe, we see to understand and we see to justify. We believe our seeing is proof positive.</p><br>
<input type="button" id="playbtn" value="Click to speak text and show word in span !"/><br>
<span id="word" style="color:orange;"></span><br><br>
<div id="panel" style="min-width:300px;word-wrap:wrap;text-align:center">

</div>


   <script type="text/javascript">
      var utterance = new SpeechSynthesisUtterance();
var wordIndex = 0;
var global_words = [];
utterance.lang = 'en-UK';
utterance.rate = 1.2;


document.getElementById('playbtn').onclick = function(){
    var text    = $('#abstract').text();
    var words   = text.split(" ");
    global_words = words;
    // Draw the text in a div
    drawTextInPanel(words);
    spokenTextArray = words;
    utterance.text = text;
    speechSynthesis.speak(utterance);
};

utterance.onboundary = function(event){
   var e = document.getElementById('abstract');
   var word = getWordAt(e.innerHTML,event.charIndex);
   console.log(word)
    // Show Speaking word : x
   document.getElementById("word").innerHTML = word;
    //Increase index of span to highlight
    // console.info(global_words[wordIndex]);
    
    try{
      document.getElementById("word_span_"+wordIndex).style.background = "orange";

    }catch(e){}
    
    wordIndex++;
};

utterance.onend = function(){
      document.getElementById("word").innerHTML = "";
    wordIndex = 0;
    document.getElementById("panel").innerHTML = "";
};

// Get the word of a string given the string and the index
function getWordAt(str, pos) {
    // Perform type conversions.
    str = String(str);
    pos = Number(pos) >>> 0;

    // Search for the word's beginning and end.
    var left = str.slice(0, pos + 1).search(/\S+$/),
        right = str.slice(pos).search(/\s/);

    // The last word in the string is a special case.
    if (right < 0) {
        return str.slice(left);
    }
    // Return the word, using the located bounds to extract it from the string.
    return str.slice(left, right + pos);
}

function drawTextInPanel(words_array){
console.log("start");
      var panel = document.getElementById("panel");
   for(var i = 0;i < words_array.length;i++){
      var html = '<span id="word_span_'+i+'">'+words_array[i]+'</span>&nbsp;';
      panel.innerHTML += html;
    }
}

   </script>
</body>

</html>